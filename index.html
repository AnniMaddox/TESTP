<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PNG vs WebP å°æ¯”</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #1a1a1a;
    color: #eee;
    min-height: 100vh;
  }

  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: #111;
    border-bottom: 1px solid #333;
    padding: 12px 16px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  .header h1 { font-size: 15px; font-weight: 700; color: #fff; white-space: nowrap; }
  .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; flex: 1; }

  .btn {
    padding: 6px 12px;
    border-radius: 20px;
    border: 1.5px solid #444;
    background: transparent;
    color: #ccc;
    font-size: 12px;
    cursor: pointer;
    transition: all .15s;
    white-space: nowrap;
  }
  .btn.active { border-color: #a78bfa; background: #a78bfa22; color: #c4b5fd; }
  .btn:active { transform: scale(0.95); }

  .upload-btn {
    padding: 6px 14px;
    border-radius: 20px;
    border: 1.5px solid #6d28d9;
    background: #6d28d922;
    color: #c4b5fd;
    font-size: 12px;
    cursor: pointer;
    white-space: nowrap;
    display: inline-block;
  }
  .upload-btn.webp-btn {
    border-color: #0d9488;
    background: #0d948822;
    color: #5eead4;
  }

  .upload-zone {
    margin: 32px auto;
    max-width: 480px;
    border: 2px dashed #444;
    border-radius: 20px;
    padding: 40px 24px;
    text-align: center;
    cursor: pointer;
    transition: border-color .2s;
  }
  .upload-zone:hover { border-color: #a78bfa; }
  .upload-zone .icon { font-size: 48px; margin-bottom: 12px; }
  .upload-zone p { color: #888; font-size: 14px; line-height: 1.8; }
  .upload-zone strong { color: #c4b5fd; }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    padding: 16px;
  }

  .card { border-radius: 16px; overflow: hidden; background: #222; border: 1px solid #333; }

  .img-wrap {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1;
    cursor: pointer;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .25s;
  }
  .img-wrap.bg-white { background: #ffffff; }
  .img-wrap.bg-dark  { background: #1a1a2e; }
  .img-wrap.bg-check {
    background-image:
      linear-gradient(45deg, #666 25%, transparent 25%),
      linear-gradient(-45deg, #666 25%, transparent 25%),
      linear-gradient(45deg, transparent 75%, #666 75%),
      linear-gradient(-45deg, transparent 75%, #666 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0;
    background-color: #999;
  }
  .img-wrap img { max-width: 100%; max-height: 100%; object-fit: contain; display: block; }

  .badge {
    position: absolute;
    top: 8px; left: 8px;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(4px);
    color: #fff;
    font-size: 11px; font-weight: 700;
    padding: 3px 8px;
    border-radius: 10px;
    letter-spacing: .04em;
  }
  .badge.webp  { background: rgba(109,40,217,0.8); }
  .badge.webp-orig { background: rgba(13,148,136,0.85); }

  .tap-hint {
    position: absolute;
    bottom: 8px; right: 8px;
    background: rgba(0,0,0,0.5);
    color: #aaa;
    font-size: 10px;
    padding: 2px 7px;
    border-radius: 8px;
  }

  .info { padding: 10px 12px; display: flex; flex-direction: column; gap: 6px; }
  .filename { font-size: 12px; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  .sizes { display: flex; gap: 6px; flex-wrap: wrap; }
  .size-tag {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 8px;
    border: 1px solid #444;
    color: #bbb;
    cursor: pointer;
    transition: all .15s;
    white-space: nowrap;
  }
  .size-tag:active { transform: scale(0.95); }
  .size-tag.selected { border-color: #a78bfa; background: #a78bfa22; color: #c4b5fd; }
  .size-tag.selected.is-teal { border-color: #5eead4; background: #0d948822; color: #5eead4; }
  .size-tag .label { font-weight: 700; }
  .size-tag .kb { color: #777; margin-left: 3px; }
  .size-tag.selected .kb { color: #9d88e0; }
  .size-tag.smallest { border-color: #34d399; }
  .size-tag.smallest .kb { color: #6ee7b7; }

  .loading { padding: 4px 0; font-size: 11px; color: #666; }
  .ratio { font-size: 11px; color: #555; }
  .ratio span { color: #34d399; }

  .summary { text-align: center; padding: 12px 16px 0; color: #666; font-size: 12px; }
  .summary strong { color: #a78bfa; }

  /* divider between PNG and WebP upload areas */
  .upload-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    max-width: 640px;
    margin: 32px auto 0;
    padding: 0 16px;
  }
  .upload-half {
    border: 2px dashed #444;
    border-radius: 16px;
    padding: 28px 16px;
    text-align: center;
    cursor: pointer;
    transition: border-color .2s;
  }
  .upload-half:hover { border-color: #a78bfa; }
  .upload-half.teal:hover { border-color: #5eead4; }
  .upload-half .icon { font-size: 32px; margin-bottom: 8px; }
  .upload-half p { color: #888; font-size: 12px; line-height: 1.6; }
  .upload-half strong { color: #c4b5fd; }
  .upload-half.teal strong { color: #5eead4; }
  .upload-hint { text-align: center; color: #555; font-size: 11px; margin-top: 8px; padding-bottom: 4px; }
</style>
</head>
<body>

<div class="header">
  <h1>ğŸ–¼ PNG vs WebP</h1>
  <div class="controls">
    <span style="font-size:11px;color:#666">èƒŒæ™¯ï¼š</span>
    <button class="btn" id="btnWhite" onclick="setBg('white')">â¬œ ç™½åº•</button>
    <button class="btn active" id="btnDark"  onclick="setBg('dark')">â¬› é»‘åº•</button>
    <button class="btn" id="btnCheck" onclick="setBg('check')">ğŸ”² æ£‹ç›¤æ ¼</button>
    <label class="upload-btn">
      ï¼‹ PNG
      <input type="file" id="pngInput" accept="image/png" multiple style="display:none">
    </label>
    <label class="upload-btn webp-btn">
      ï¼‹ WebP
      <input type="file" id="webpInput" accept="image/webp" multiple style="display:none">
    </label>
  </div>
</div>

<!-- Initial upload zone (only before any files loaded) -->
<div id="uploadArea">
  <div class="upload-row">
    <div class="upload-half" onclick="document.getElementById('pngInput').click()">
      <div class="icon">ğŸ—‚</div>
      <p><strong>ä¸Šå‚³ PNG</strong><br>è‡ªå‹•è½‰å‡ºå¤šå“è³ª WebP å°æ¯”</p>
    </div>
    <div class="upload-half teal" onclick="document.getElementById('webpInput').click()">
      <div class="icon">ğŸ–¼</div>
      <p><strong>ä¸Šå‚³ WebP</strong><br>ç›´æ¥çœ‹åŸå§‹ WebP é•·æ€æ¨£</p>
    </div>
  </div>
  <p class="upload-hint">ä¹Ÿå¯ä»¥ç›´æ¥æŠŠåœ–ç‰‡æ‹–é€²ä¾†</p>
</div>

<div id="summary" class="summary" style="display:none"></div>
<div id="grid" class="grid"></div>

<script>
let currentBg = 'dark';
let totalCards = 0;

function setBg(bg) {
  currentBg = bg;
  ['white','dark','check'].forEach(b => {
    document.getElementById('btn' + b[0].toUpperCase() + b.slice(1))
      .classList.toggle('active', b === bg);
  });
  document.querySelectorAll('.img-wrap').forEach(el => {
    el.className = 'img-wrap bg-' + bg;
  });
}

document.getElementById('pngInput').addEventListener('change', e => {
  handleFiles(Array.from(e.target.files), 'png');
  e.target.value = '';
});
document.getElementById('webpInput').addEventListener('change', e => {
  handleFiles(Array.from(e.target.files), 'webp');
  e.target.value = '';
});

// Drag & drop on body
document.body.addEventListener('dragover', e => e.preventDefault());
document.body.addEventListener('drop', e => {
  e.preventDefault();
  const files = Array.from(e.dataTransfer.files);
  const pngs  = files.filter(f => f.type === 'image/png');
  const webps = files.filter(f => f.type === 'image/webp');
  if (pngs.length)  handleFiles(pngs,  'png');
  if (webps.length) handleFiles(webps, 'webp');
});

function handleFiles(files, type) {
  if (!files.length) return;
  document.getElementById('uploadArea').style.display = 'none';
  document.getElementById('summary').style.display = 'block';
  files.forEach(f => type === 'png' ? processPng(f) : processWebp(f));
}

const QUALITIES = [
  { label: 'Q95', q: 0.95 },
  { label: 'Q85', q: 0.85 },
  { label: 'Q75', q: 0.75 },
  { label: 'Q60', q: 0.60 },
];

function fmtKB(b) {
  if (b < 1024) return b + 'B';
  if (b < 1024*1024) return (b/1024).toFixed(1) + 'KB';
  return (b/1024/1024).toFixed(2) + 'MB';
}

// â”€â”€ PNG: auto-convert to WebP variants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function processPng(file) {
  const uid = makeUid();
  const card = makeCard(uid, file.name, 'è½‰æ›ä¸­â€¦');
  document.getElementById('grid').prepend(card);

  const pngUrl = URL.createObjectURL(file);
  const img = new Image();
  img.onload = () => {
    const canvas = document.createElement('canvas');
    canvas.width = img.naturalWidth;
    canvas.height = img.naturalHeight;
    canvas.getContext('2d').drawImage(img, 0, 0);

    const versions = [{ label: 'PNG', dataUrl: pngUrl, size: file.size, isWebp: false }];

    Promise.all(QUALITIES.map(q => new Promise(res => {
      canvas.toBlob(blob => {
        if (!blob) return res(null);
        res({ label: q.label, dataUrl: URL.createObjectURL(blob), size: blob.size, isWebp: true });
      }, 'image/webp', q.q);
    }))).then(results => {
      results.forEach(r => r && versions.push(r));
      const minWebp = Math.min(...versions.filter(v => v.isWebp).map(v => v.size));
      const saving  = Math.round((1 - minWebp / file.size) * 100);
      finishCard(uid, versions, minWebp,
        saving > 0 ? `æœ€å° WebP æ¯” PNG å° <span>${saving}%</span>` : 'WebP ç„¡æ˜é¡¯ç¯€çœ');
    });
  };
  img.src = pngUrl;
}

// â”€â”€ WebP: display as-is, no conversion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function processWebp(file) {
  const uid = makeUid();
  const card = makeCard(uid, file.name, '');
  document.getElementById('grid').prepend(card);

  const url = URL.createObjectURL(file);
  const versions = [{ label: 'WebP', dataUrl: url, size: file.size, isWebp: true, isOrig: true }];
  finishCard(uid, versions, null, `åŸå§‹ WebP Â· ${fmtKB(file.size)}`);
}

// â”€â”€ Shared card builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function makeUid() { return 'u' + Date.now() + Math.random().toString(36).slice(2); }

function makeCard(uid, filename, loadingText) {
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="img-wrap bg-${currentBg}" id="wrap-${uid}">
      <img id="img-${uid}" alt="">
      <span class="badge" id="badge-${uid}">â€¦</span>
      <span class="tap-hint">é»æ“Šæ›ç‰ˆæœ¬</span>
    </div>
    <div class="info">
      <div class="filename">${filename}</div>
      <div class="loading" id="load-${uid}">${loadingText}</div>
      <div class="sizes" id="sizes-${uid}" style="display:none"></div>
      <div class="ratio" id="ratio-${uid}"></div>
    </div>`;
  return card;
}

function finishCard(uid, versions, minWebp, ratioHtml) {
  const imgEl   = document.getElementById('img-' + uid);
  const badge   = document.getElementById('badge-' + uid);
  const loadEl  = document.getElementById('load-' + uid);
  const sizesEl = document.getElementById('sizes-' + uid);
  const ratioEl = document.getElementById('ratio-' + uid);

  loadEl.style.display  = 'none';
  sizesEl.style.display = 'flex';
  ratioEl.innerHTML = ratioHtml;

  versions.forEach((v, i) => {
    const tag = document.createElement('div');
    const isSmall = minWebp !== null && v.isWebp && v.size === minWebp;
    const isTeal  = v.isOrig;
    tag.className = 'size-tag' + (i === 0 ? ' selected' + (isTeal ? ' is-teal' : '') : '') + (isSmall ? ' smallest' : '');
    tag.innerHTML = `<span class="label">${v.label}</span><span class="kb">${fmtKB(v.size)}</span>`;
    tag.addEventListener('click', () => switchTo(i));
    sizesEl.appendChild(tag);
  });

  let current = 0;
  switchTo(0);

  function switchTo(i) {
    current = i;
    const v = versions[i];
    imgEl.src = v.dataUrl;
    badge.textContent = v.label;
    badge.className = 'badge' + (v.isOrig ? ' webp-orig' : v.isWebp ? ' webp' : '');
    sizesEl.querySelectorAll('.size-tag').forEach((t, j) => {
      t.classList.toggle('selected', j === i);
      if (j === i) t.classList.toggle('is-teal', !!versions[j].isOrig);
    });
  }

  document.getElementById('wrap-' + uid).addEventListener('click', () => {
    switchTo((current + 1) % versions.length);
  });

  totalCards++;
  updateSummary();
}

function updateSummary() {
  document.getElementById('summary').innerHTML =
    `å·²è¼‰å…¥ <strong>${totalCards}</strong> å¼µ Â· é»åœ–ç‰‡å¾ªç’°åˆ‡æ›ç‰ˆæœ¬ Â· é»æ¨™ç±¤ç›´æ¥è·³`;
}
</script>
</body>
</html>
