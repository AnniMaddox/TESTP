<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PNG vs WebP å°æ¯”</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #1a1a1a;
    color: #eee;
    min-height: 100vh;
  }

  /* â”€â”€ Header â”€â”€ */
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: #111;
    border-bottom: 1px solid #333;
    padding: 12px 16px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }

  .header h1 {
    font-size: 15px;
    font-weight: 700;
    color: #fff;
    white-space: nowrap;
  }

  .controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    flex: 1;
  }

  .btn {
    padding: 6px 12px;
    border-radius: 20px;
    border: 1.5px solid #444;
    background: transparent;
    color: #ccc;
    font-size: 12px;
    cursor: pointer;
    transition: all .15s;
    white-space: nowrap;
  }
  .btn.active { border-color: #a78bfa; background: #a78bfa22; color: #c4b5fd; }
  .btn:active { transform: scale(0.95); }

  .upload-btn {
    padding: 6px 14px;
    border-radius: 20px;
    border: 1.5px solid #6d28d9;
    background: #6d28d922;
    color: #c4b5fd;
    font-size: 12px;
    cursor: pointer;
    white-space: nowrap;
  }

  /* â”€â”€ Upload zone â”€â”€ */
  .upload-zone {
    margin: 40px auto;
    max-width: 480px;
    border: 2px dashed #444;
    border-radius: 20px;
    padding: 48px 24px;
    text-align: center;
    cursor: pointer;
    transition: border-color .2s;
  }
  .upload-zone:hover { border-color: #a78bfa; }
  .upload-zone .icon { font-size: 48px; margin-bottom: 12px; }
  .upload-zone p { color: #888; font-size: 14px; line-height: 1.6; }
  .upload-zone strong { color: #c4b5fd; }
  #fileInput { display: none; }

  /* â”€â”€ Grid â”€â”€ */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    padding: 16px;
  }

  /* â”€â”€ Card â”€â”€ */
  .card {
    border-radius: 16px;
    overflow: hidden;
    background: #222;
    border: 1px solid #333;
  }

  .img-wrap {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1;
    cursor: pointer;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* backgrounds */
  .bg-white .img-wrap { background: #ffffff; }
  .bg-dark  .img-wrap { background: #1a1a2e; }
  .bg-check .img-wrap {
    background-image:
      linear-gradient(45deg, #555 25%, transparent 25%),
      linear-gradient(-45deg, #555 25%, transparent 25%),
      linear-gradient(45deg, transparent 75%, #555 75%),
      linear-gradient(-45deg, transparent 75%, #555 75%);
    background-size: 16px 16px;
    background-position: 0 0, 0 8px, 8px -8px, -8px 0;
    background-color: #333;
  }

  .img-wrap img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: block;
  }

  /* version badge */
  .badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(4px);
    color: #fff;
    font-size: 11px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 10px;
    letter-spacing: .04em;
  }
  .badge.webp { background: rgba(109,40,217,0.8); }

  /* tap hint */
  .tap-hint {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0,0,0,0.5);
    color: #aaa;
    font-size: 10px;
    padding: 2px 7px;
    border-radius: 8px;
  }

  /* info bar */
  .info {
    padding: 10px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .filename {
    font-size: 12px;
    color: #aaa;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .sizes {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .size-tag {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 8px;
    border: 1px solid #444;
    color: #bbb;
    cursor: pointer;
    transition: all .15s;
    white-space: nowrap;
  }
  .size-tag:active { transform: scale(0.95); }
  .size-tag.selected { border-color: #a78bfa; background: #a78bfa22; color: #c4b5fd; }
  .size-tag .label { font-weight: 700; }
  .size-tag .kb { color: #777; margin-left: 3px; }
  .size-tag.selected .kb { color: #9d88e0; }
  .size-tag.best-ratio { border-color: #34d399; }
  .size-tag.best-ratio .kb { color: #6ee7b7; }

  /* loading */
  .loading {
    padding: 8px 12px;
    font-size: 11px;
    color: #666;
  }

  /* summary bar */
  .summary {
    text-align: center;
    padding: 12px 16px 0;
    color: #666;
    font-size: 12px;
  }
  .summary strong { color: #a78bfa; }
</style>
</head>
<body>

<div class="header">
  <h1>ğŸ–¼ PNG vs WebP</h1>
  <div class="controls">
    <span style="font-size:11px;color:#666">èƒŒæ™¯ï¼š</span>
    <button class="btn" id="btnWhite" onclick="setBg('white')">ç™½åº•</button>
    <button class="btn active" id="btnDark"  onclick="setBg('dark')">é»‘åº•</button>
    <button class="btn" id="btnCheck" onclick="setBg('check')">æ£‹ç›¤æ ¼</button>
    <label class="upload-btn">ï¼‹ é¸åœ– <input type="file" id="fileInput" accept="image/png,image/webp" multiple></label>
  </div>
</div>

<input type="file" id="fileInput" accept="image/png,image/webp" multiple style="display:none">

<div id="uploadZone" class="upload-zone" onclick="document.getElementById('fileInput').click()">
  <div class="icon">ğŸ—‚</div>
  <p><strong>é»é€™è£¡é¸ PNG åœ–ç‰‡</strong>ï¼ˆå¯å¤šé¸ï¼‰<br>é é¢æœƒè‡ªå‹•è½‰æ›æˆ WebP å„å“è³ª<br>è®“ä½ å°æ¯”å·®åˆ¥</p>
</div>

<div id="summary" class="summary" style="display:none"></div>
<div id="grid" class="grid"></div>

<script>
let currentBg = 'dark';

function setBg(bg) {
  currentBg = bg;
  ['white','dark','check'].forEach(b => {
    document.getElementById('btn'+b.charAt(0).toUpperCase()+b.slice(1)).classList.toggle('active', b===bg);
  });
  document.querySelectorAll('.img-wrap').forEach(el => {
    el.className = 'img-wrap bg-' + bg;
  });
}

// File input
document.getElementById('fileInput').addEventListener('change', e => {
  const files = Array.from(e.target.files).filter(f => f.type === 'image/png' || f.type === 'image/webp');
  if (!files.length) return;
  document.getElementById('uploadZone').style.display = 'none';
  document.getElementById('summary').style.display = 'block';
  files.forEach(processFile);
  e.target.value = '';
});

// Also handle drop on upload zone
const zone = document.getElementById('uploadZone');
zone.addEventListener('dragover', e => { e.preventDefault(); zone.style.borderColor='#a78bfa'; });
zone.addEventListener('dragleave', () => { zone.style.borderColor=''; });
zone.addEventListener('drop', e => {
  e.preventDefault();
  zone.style.borderColor = '';
  const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'image/png' || f.type === 'image/webp');
  if (!files.length) return;
  zone.style.display = 'none';
  document.getElementById('summary').style.display = 'block';
  files.forEach(processFile);
});

const QUALITIES = [
  { label: 'Q95', q: 0.95 },
  { label: 'Q85', q: 0.85 },
  { label: 'Q75', q: 0.75 },
  { label: 'Q60', q: 0.60 },
];

function fmtKB(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024*1024) return (bytes/1024).toFixed(1) + ' KB';
  return (bytes/1024/1024).toFixed(2) + ' MB';
}

function processFile(file) {
  const isPng = file.type === 'image/png';
  const grid = document.getElementById('grid');

  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="img-wrap bg-${currentBg}">
      <img id="img-${Date.now()}" alt="">
      <span class="badge">${isPng ? 'PNG' : 'WebP'}</span>
      <span class="tap-hint">é»æ“Šåˆ‡æ›ç‰ˆæœ¬</span>
    </div>
    <div class="info">
      <div class="filename">${file.name}</div>
      <div class="loading">è½‰æ›ä¸­â€¦</div>
      <div class="sizes" style="display:none"></div>
    </div>
  `;
  grid.prepend(card);

  const imgEl = card.querySelector('img');
  const badge = card.querySelector('.badge');
  const sizesEl = card.querySelector('.sizes');
  const loadingEl = card.querySelector('.loading');

  const url = URL.createObjectURL(file);
  const image = new Image();
  image.onload = () => {
    // Draw to canvas
    const canvas = document.createElement('canvas');
    canvas.width = image.naturalWidth;
    canvas.height = image.naturalHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(image, 0, 0);

    // Build versions
    const versions = [];

    // Original PNG (or WebP)
    versions.push({
      label: isPng ? 'PNG' : 'WebPåŸ',
      dataUrl: url,
      size: file.size,
      isWebp: !isPng,
    });

    // Convert to WebP at each quality
    const pending = QUALITIES.map(q => new Promise(resolve => {
      canvas.toBlob(blob => {
        if (!blob) { resolve(null); return; }
        const du = URL.createObjectURL(blob);
        resolve({ label: q.label, dataUrl: du, size: blob.size, isWebp: true });
      }, 'image/webp', q.q);
    }));

    Promise.all(pending).then(results => {
      results.forEach(r => r && versions.push(r));

      // Find best ratio (smallest WebP)
      const webpVersions = versions.filter(v => v.isWebp && v.label !== 'WebPåŸ');
      const minSize = webpVersions.length ? Math.min(...webpVersions.map(v=>v.size)) : Infinity;

      // Render size tags
      loadingEl.style.display = 'none';
      sizesEl.style.display = 'flex';

      versions.forEach((v, i) => {
        const tag = document.createElement('div');
        tag.className = 'size-tag' + (i===0?' selected':'') + (v.size===minSize&&v.isWebp?' best-ratio':'');
        tag.innerHTML = `<span class="label">${v.label}</span><span class="kb">${fmtKB(v.size)}</span>`;
        tag.onclick = () => switchTo(i);
        sizesEl.appendChild(tag);
      });

      let current = 0;
      imgEl.src = versions[0].dataUrl;

      function switchTo(i) {
        current = i;
        const v = versions[i];
        imgEl.src = v.dataUrl;
        badge.textContent = v.label;
        badge.className = 'badge' + (v.isWebp ? ' webp' : '');
        sizesEl.querySelectorAll('.size-tag').forEach((t,j) => t.classList.toggle('selected', j===i));
      }

      // Click image cycles through versions
      card.querySelector('.img-wrap').onclick = () => {
        switchTo((current + 1) % versions.length);
      };

      updateSummary();
    });
  };
  image.src = url;
}

function updateSummary() {
  const count = document.querySelectorAll('.card').length;
  document.getElementById('summary').innerHTML =
    `å·²è¼‰å…¥ <strong>${count}</strong> å¼µåœ– Â·  <span style="color:#666">é»åœ–ç‰‡åˆ‡æ›ç‰ˆæœ¬ï¼Œé»æ¨™ç±¤ç›´æ¥è·³</span>`;
}
</script>
</body>
</html>
